<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Regression | Tools Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Chart.js for visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- SheetJS for Excel import -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                
                <div class="header-right">
                    <div class="theme-toggle">
                        <button data-theme-toggle="light" aria-pressed="false" title="Light mode">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"/>
                                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                            </svg>
                        </button>
                        <button data-theme-toggle="dark" aria-pressed="false" title="Dark mode">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div style="margin-top: 24px; display: flex; align-items: center; gap: 16px;">
                <div class="tool-icon-header educational">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3v18h18"/>
                        <path d="M7 16l4-8 4 4 5-9"/>
                    </svg>
                </div>
                <div>
                    <h1>Linear Regression</h1>
                    <p class="tagline">// STATISTICAL ANALYSIS • DATA FITTING</p>
                </div>
            </div>
        </header>

        <main>
            <div class="import-panel" style="margin-bottom: 24px; padding: 24px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px;">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-icon">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <path d="M12 18v-6"/>
                                <path d="M9 15l3 3 3-3"/>
                            </svg>
                        </span>
                        <h2>Data Import</h2>
                    </div>
                </div>

                <div class="file-drop-zone" id="fileDropZone" tabindex="0" role="button" aria-label="Drop file here or click to browse for CSV or Excel files">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    <p><strong>Drop file here</strong> or click to browse</p>
                    <p class="formats">CSV, Excel (.xlsx, .xls), or paste from Excel</p>
                </div>

                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display: none;">

                <div class="selector-group" style="margin-top: 12px;">
                    <label>Load Example Dataset</label>
                    <div style="display: flex; gap: 8px;">
                        <select id="exampleSelect" style="flex: 1;">
                            <option value="simple">Simple X,Y (Basic)</option>
                            <option value="housing" selected>Housing Prices (Multiple Regression)</option>
                            <option value="projectile">Projectile Motion (Polynomial)</option>
                            <option value="fuel_efficiency">Fuel Efficiency (WLS)</option>
                            <option value="cell_activity">Cell Activity (LOESS)</option>
                            <option value="cauchy_noise">Cauchy Noise (OLS Breaker)</option>
                            <option value="singular">Singular Matrix (Unsolvable)</option>
                            <option value="messy">Messy Data (Confounding Variable)</option>
                        </select>
                        <button class="tool-btn" id="loadExampleBtn" style="padding: 10px 16px;">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="12" y1="18" x2="12" y2="12"/>
                                <line x1="9" y1="15" x2="15" y2="15"/>
                            </svg>
                        </button>
                    </div>
                    <p id="exampleDescription" style="font-size: 0.75rem; color: var(--text-muted); margin-top: 6px;">
                        Demonstrates multiple regression with real-world relationships between price, square footage, bedrooms, and age.
                    </p>
                </div>

                <div class="paste-area">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <label style="font-family: 'JetBrains Mono', monospace; font-size: 0.6875rem; color: var(--text-muted); text-transform: uppercase;">Or paste data from Excel</label>
                        <button class="tool-btn" id="clearPasteBtn" aria-label="Clear pasted data" style="padding: 4px 12px; font-size: 0.75rem;">Clear</button>
                    </div>
                    <textarea id="pasteArea" aria-label="Paste Excel or CSV data here" placeholder="Paste Excel/CSV data here...

Example:
X1,X2,Y
1,2,3.5
2,3,5.2
3,4,6.8"></textarea>
                </div>

                <div id="dataPreview" style="display: none;">
                    <div class="section-header">Data Preview</div>
                    <div class="table-container">
                        <table class="data-table" id="previewTable">
                            <!-- Populated dynamically -->
                        </table>
                    </div>
                    <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 8px;">
                        Showing first 10 rows of <span id="totalRows">0</span> total rows
                    </p>
                </div>
            </div>

            <div class="calculator-layout">
            <aside class="sidebar">
                <div class="panel-header">
                    <h2>Variables</h2>
                </div>

                <div class="column-selectors" id="columnSelectors">
                    <p style="color: var(--text-muted); font-size: 0.875rem; font-style: italic;">
                        Import data to select variables
                    </p>
                </div>

                <!-- Regression Method Selection -->
                <div id="regressionMethodPanel" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                    <div class="selector-group">
                        <label>Regression Method</label>
                        <select id="regressionMethodSelect" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-input); color: var(--text-primary);">
                            <option value="ols">OLS (Ordinary Least Squares)</option>
                            <option value="ridge">Ridge (L2 Regularized)</option>
                            <option value="lasso">Lasso (L1 Regularized)</option>
                            <option value="elastic_net">Elastic Net (L1 + L2)</option>
                            <option value="wls">WLS (Weighted Least Squares)</option>
                            <option value="loess">LOESS (Non-Parametric Smoothing)</option>
                        </select>
                    </div>

                    <!-- Ridge/Lasso Parameters -->
                    <div id="regularizedParams" style="display: none; margin-top: 12px; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
                        <div class="selector-group" style="margin-bottom: 12px;">
                            <label for="lambdaSlider">Lambda (λ): <span id="lambdaValue">1.0</span></label>
                            <input type="range" id="lambdaSlider" min="0.01" max="10" step="0.01" value="1.0" style="width: 100%;">
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">
                                <span>0.01 (weak)</span>
                                <span>10 (strong)</span>
                            </div>
                        </div>
                        <div class="selector-group" style="margin-bottom: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="standardizeCheck" checked>
                                <span>Standardize predictors (recommended)</span>
                            </label>
                        </div>
                        <!-- Lasso-specific parameters -->
                        <div id="lassoParams" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                            <div class="selector-group" style="margin-bottom: 12px;">
                                <label for="maxIterInput">Max Iterations: <span id="maxIterValue">1000</span></label>
                                <input type="range" id="maxIterSlider" min="100" max="10000" step="100" value="1000" style="width: 100%;">
                                <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">
                                    <span>100</span>
                                    <span>10000</span>
                                </div>
                            </div>
                            <div class="selector-group" style="margin-bottom: 8px;">
                                <label for="tolInput">Convergence Tolerance: <span id="tolValue">1e-7</span></label>
                                <select id="tolSelect" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-input); color: var(--text-primary);">
                                    <option value="1e-10">1e-10 (Very precise)</option>
                                    <option value="1e-7" selected>1e-7 (Default)</option>
                                    <option value="1e-5">1e-5 (Relaxed)</option>
                                    <option value="1e-3">1e-3 (Loose)</option>
                                </select>
                            </div>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--text-muted); margin: 0;">
                            <strong>Ridge</strong> shrinks coefficients toward zero (handles multicollinearity).<br>
                            <strong>Lasso</strong> can set coefficients to exactly zero (variable selection).
                        </p>
                    </div>

                    <!-- Elastic Net Parameters -->
                    <div id="elasticNetOptions" style="display: none; margin-top: 12px; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
                        <div class="selector-group" style="margin-bottom: 12px;">
                            <label for="enLambdaSlider">Lambda (λ): <span id="enLambdaValue">1.0</span></label>
                            <input type="range" id="enLambdaSlider" min="0.01" max="10" step="0.01" value="1.0" style="width: 100%;">
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">
                                <span>0.01 (weak)</span>
                                <span>10 (strong)</span>
                            </div>
                        </div>
                        <div class="selector-group" style="margin-bottom: 12px;">
                            <label for="enAlphaSlider">Alpha (α): <span id="enAlphaValue">0.5</span></label>
                            <input type="range" id="enAlphaSlider" min="0" max="1" step="0.01" value="0.5" style="width: 100%;">
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">
                                <span>0 (Ridge)</span>
                                <span>0.5 (Equal)</span>
                                <span>1 (Lasso)</span>
                            </div>
                        </div>
                        <div class="selector-group" style="margin-bottom: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="enStandardizeCheck" checked>
                                <span>Standardize predictors (recommended)</span>
                            </label>
                        </div>
                        <div class="selector-group" style="margin-bottom: 12px;">
                            <label for="enMaxIterInput">Max Iterations: <span id="enMaxIterValue">1000</span></label>
                            <input type="range" id="enMaxIterSlider" min="100" max="10000" step="100" value="1000" style="width: 100%;">
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">
                                <span>100</span>
                                <span>10000</span>
                            </div>
                        </div>
                        <div class="selector-group" style="margin-bottom: 8px;">
                            <label for="enTolInput">Convergence Tolerance: <span id="enTolValue">1e-7</span></label>
                            <select id="enTolSelect" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-input); color: var(--text-primary);">
                                <option value="1e-10">1e-10 (Very precise)</option>
                                <option value="1e-7" selected>1e-7 (Default)</option>
                                <option value="1e-5">1e-5 (Relaxed)</option>
                                <option value="1e-3">1e-3 (Loose)</option>
                            </select>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--text-muted); margin: 0;">
                            <strong>Elastic Net</strong> combines Ridge (α=0) and Lasso (α=1) penalties. Alpha controls the mix: 0.5 gives equal weight to both penalties.
                        </p>
                    </div>

                    <!-- LOESS Parameters -->
                    <div id="loessOptions" style="display: none; margin-top: 12px; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
                        <div class="selector-group" style="margin-bottom: 12px;">
                            <label for="loessSpanSlider">Span: <span id="loessSpanValue">0.75</span></label>
                            <input type="range" id="loessSpanSlider" min="0.01" max="1.00" step="0.01" value="0.75" style="width: 100%;">
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">
                                <span>0.01 (wiggly)</span>
                                <span>1.00 (smooth)</span>
                            </div>
                        </div>
                        <div class="selector-group" style="margin-bottom: 12px;">
                            <label for="loessDegreeSelect">Polynomial Degree</label>
                            <select id="loessDegreeSelect" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-input); color: var(--text-primary);">
                                <option value="0">Constant (Local Average)</option>
                                <option value="1" selected>Linear (Default)</option>
                                <option value="2">Quadratic (More Flexible)</option>
                            </select>
                        </div>
                        <div class="selector-group" style="margin-bottom: 12px;">
                            <label for="loessSurfaceSelect">Surface Method</label>
                            <select id="loessSurfaceSelect" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-input); color: var(--text-primary);">
                                <option value="direct" selected>Direct (Exact, Slower)</option>
                                <option value="interpolate">Interpolate (Approximate, Faster)</option>
                            </select>
                        </div>
                        <div class="selector-group" style="margin-bottom: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="loessRobustCheck">
                                <span>Robust Fitting (2 iterations to reduce outlier influence)</span>
                            </label>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--text-muted); margin: 0;">
                            <strong>LOESS</strong> fits smooth curves through data without assuming a functional form.
                            Span controls smoothness - smaller values follow data closely, larger values produce smoother curves.
                        </p>
                    </div>

                    <!-- WLS Parameters -->
                    <div id="wlsOptions" style="display: none; margin-top: 12px; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
                        <div class="selector-group" style="margin-bottom: 12px;">
                            <label for="wlsWeightsSelect">Weights Variable</label>
                            <select id="wlsWeightsSelect" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-input); color: var(--text-primary);">
                                <option value="">-- Select weights variable --</option>
                            </select>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--text-muted); margin: 0;">
                            <strong>WLS</strong> (Weighted Least Squares) assigns different weights to observations. Useful for heteroscedasticity where variance differs across observations. Weights must be non-negative.
                        </p>
                    </div>
                </div>

                <button class="tool-btn primary" id="runRegressionBtn" style="width: 100%; margin-top: 16px; padding: 12px; font-size: 0.9375rem; display: none;" aria-label="Run linear regression analysis">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: text-bottom;">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                    Run Regression
                </button>

                <div style="margin-top: 24px;">
                    <div class="collapsible-header collapsed" id="disclaimerToggle" aria-expanded="false" role="button" tabindex="0" style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <span class="title" style="color: var(--accent-warning); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">
                            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px; vertical-align: text-bottom;">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            Professional Use Disclaimer
                        </span>
                        <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </div>
                    <div class="collapsible-content collapsed" id="disclaimerContent">
                        <div class="disclaimer-warning" style="margin-top: 12px; border: none; background: transparent; padding: 0;">
                            <p><strong>FOR EDUCATIONAL & RESEARCH PURPOSES.</strong> This tool provides statistical calculations using Ordinary Least Squares (OLS) regression. Results should be validated using professional statistical software.</p>
                            <p><strong>ASSUMPTIONS NOT CHECKED.</strong> This tool does not verify linearity, normality, homoscedasticity, independence, or multicollinearity. Violating these assumptions may invalidate results.</p>
                            <p><strong>NO PROFESSIONAL ADVICE.</strong> Consult a statistician for research design, hypothesis testing, and interpretation. This tool is not a substitute for professional statistical analysis.</p>
                            <p><strong>LIMITATION OF LIABILITY.</strong> The creators assume NO LIABILITY for errors or outcomes. Users must validate all calculations and interpretations.</p>
                        </div>
                    </div>
                </div>

                <div class="panel-header" style="margin-top: 32px;">
                    <h2>Statistics</h2>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="value" id="rSquared">-</div>
                        <div class="label">R²</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="adjRSquared">-</div>
                        <div class="label">Adj R²</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="rmse">-</div>
                        <div class="label">RMSE</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="mae">-</div>
                        <div class="label">MAE</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="fStat">-</div>
                        <div class="label">F-Stat</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="pValue">-</div>
                        <div class="label">p-value</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="aic">-</div>
                        <div class="label">AIC</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="bic">-</div>
                        <div class="label">BIC</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="logLikelihood">-</div>
                        <div class="label">Log-Likelihood</div>
                    </div>
                </div>

                <div class="equation-box">
                    <div class="chart-title">Regression Equation</div>
                    <div class="equation" id="equation">y = β₀ + β₁x₁ + ... + βₖxₖ</div>
                </div>
            </aside>

            <div class="calculator-panel">
                <div id="resultsSection" style="display: none;">
                    <div class="section-header">
                        <span>Scatter Plot</span>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title" id="mainChartTitle">Scatter Plot with Regression Line</div>
                        <div class="chart-wrapper">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Residuals vs Fitted Values</div>
                        <div class="chart-wrapper">
                            <canvas id="residualsChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Normal Q-Q Plot (Residuals)</div>
                        <div class="chart-wrapper">
                            <canvas id="qqChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Residuals vs Leverage</div>
                        <div class="chart-wrapper">
                            <canvas id="leverageChart"></canvas>
                        </div>
                    </div>

                    <div class="section-header">Coefficients</div>
                    <div style="overflow-x: auto;">
                        <table class="coefficients-table" id="coefficientsTable">
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>Coefficient</th>
                                    <th>Std Error</th>
                                    <th>t-stat</th>
                                    <th>p-value</th>
                                    <th>95% CI Lower</th>
                                    <th>95% CI Upper</th>
                                </tr>
                            </thead>
                            <tbody id="coefficientsBody">
                                <!-- Populated dynamically -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Diagnostics Panel (Linearity Tests) -->
                    <div style="margin-top: 24px;">
                        <div class="section-header">
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                            </svg>
                            <span>Diagnostic Tests</span>
                        </div>
                        <p style="font-size: 0.8rem; color: var(--text-muted); margin: 4px 0 12px;">
                            Tests for regression assumptions (linearity, homoscedasticity, normality, etc.)
                        </p>

                        <!-- Individual Test Buttons -->
                        <div id="diagnosticButtons" style="display: none; margin-bottom: 16px;">
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px;">
                                <button class="tool-btn diagnostic-btn" data-test="linearity" style="padding: 6px 12px; font-size: 0.75rem;">
                                    Linearity Tests
                                </button>
                                <button class="tool-btn diagnostic-btn" data-test="heteroscedasticity" style="padding: 6px 12px; font-size: 0.75rem;">
                                    Heteroscedasticity Tests
                                </button>
                                <button class="tool-btn diagnostic-btn" data-test="normality" style="padding: 6px 12px; font-size: 0.75rem;">
                                    Normality Tests
                                </button>
                                <button class="tool-btn diagnostic-btn" data-test="autocorrelation" style="padding: 6px 12px; font-size: 0.75rem;">
                                    Autocorrelation Test
                                </button>
                                <button class="tool-btn diagnostic-btn" data-test="influence" style="padding: 6px 12px; font-size: 0.75rem;">
                                    Influence Test
                                </button>
                                <button class="tool-btn diagnostic-btn" data-test="all" style="padding: 6px 12px; font-size: 0.75rem; background: var(--accent-educational);">
                                    Run All Tests
                                </button>
                            </div>
                            <p style="font-size: 0.7rem; color: var(--text-muted); margin: 0;">
                                Note: Diagnostic tests analyze residuals and can be run after any regression method.
                            </p>
                        </div>

                        <div id="diagnosticsResults">
                            <div class="diagnostics-empty">
                                <p style="color: var(--text-muted); font-size: 0.875rem;">Run regression to see diagnostic test results</p>
                            </div>
                        </div>
                    </div>

                    <div class="collapsible-header" id="residualsToggle" aria-expanded="true" role="button" tabindex="0">
                        <span class="title">Residuals Table</span>
                        <svg class="icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </div>
                    <div class="collapsible-content" id="residualsContent">
                        <!-- Quick Action Buttons -->
                        <div class="quick-actions">
                            <button class="quick-action-btn" data-filter="influential" id="filterInfluentialBtn" title="Show observations with high leverage, Cook's D, or DFFITS">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 8v4M12 16h.01"/>
                                </svg>
                                Influential Obs
                            </button>
                            <button class="quick-action-btn" data-filter="outliers" id="filterOutliersBtn" title="Show observations with |std residual| > 2">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 3l18 18M3 21l18-18"/>
                                </svg>
                                Outliers
                            </button>
                            <button class="quick-action-btn" data-filter="reset" id="resetFilterBtn" title="Show all observations">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                                    <path d="M3 3v5h5"/>
                                </svg>
                                Reset
                            </button>
                            <button class="quick-action-btn" id="saveModelBtn" title="Save current model for comparison">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                Save Model
                            </button>
                            <button class="quick-action-btn" id="compareModelsBtn" title="Compare saved models">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="8" height="18" rx="1"/>
                                    <rect x="13" y="3" width="8" height="18" rx="1"/>
                                </svg>
                                Compare Models
                            </button>
                        </div>

                        <div class="table-container" style="max-height: 200px;">
                            <table class="data-table" id="residualsTable">
                                <thead>
                                    <tr>
                                        <th data-sort="index">#</th>
                                        <th data-sort="actual">Actual ↕</th>
                                        <th data-sort="predicted">Predicted ↕</th>
                                        <th data-sort="residual">Residual ↕</th>
                                        <th data-sort="stdResidual">Std. Residual ↕</th>
                                        <th data-sort="leverage">Leverage ↕</th>
                                    </tr>
                                </thead>
                                <tbody id="residualsBody">
                                    <!-- Populated dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="export-buttons">
                        <button class="tool-btn" id="exportPngBtn">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Export Charts (PNG)
                        </button>
                        <button class="tool-btn" id="exportCsvBtn">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Export Results (CSV)
                        </button>
                        <button class="tool-btn" id="exportAugmentedBtn" title="Export residuals with all diagnostic metrics (Cook's D, DFFITS, DFBETAS)">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="12" y1="18" x2="12" y2="12"/>
                                <line x1="9" y1="15" x2="15" y2="15"/>
                            </svg>
                            Export Augmented Data
                        </button>
                    </div>

                    <div class="section-header" style="margin-top: 32px;">
                        <span>What is Linear Regression?</span>
                    </div>

                    <div class="collapsible-header collapsed" id="helpToggle" aria-expanded="false" role="button" tabindex="0">
                        <span class="title">Click to expand explanation of metrics and concepts</span>
                        <svg class="icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </div>
                    <div class="collapsible-content collapsed" id="helpContent">
                        <div style="padding: 16px; background: var(--bg-secondary); border-radius: 8px; font-size: 0.875rem; line-height: 1.7;">
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: var(--accent-educational); margin-bottom: 8px;">What is Linear Regression?</h4>
                                <p style="margin: 0; color: var(--text-secondary);">
                                    Linear regression is a statistical method used to model the relationship between a dependent variable (Y) and one or more independent variables (X). It finds the best-fitting straight line (or hyperplane for multiple predictors) that minimizes the sum of squared differences between observed and predicted values.
                                </p>
                                <p style="margin: 8px 0 0; color: var(--text-secondary);">
                                    <strong>Simple regression:</strong> One predictor (y = mx + b)<br>
                                    <strong>Multiple regression:</strong> Multiple predictors (y = b + m₁x₁ + m₂x₂ + ... + mₖxₖ)
                                </p>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                                <div>
                                    <h5 style="color: var(--text-primary); margin-bottom: 8px;">Model Fit Statistics</h5>
                                    <dl style="margin: 0; color: var(--text-secondary);">
                                        <dt style="font-weight: 600; color: var(--text-primary);">R² (R-squared)</dt>
                                        <dd style="margin: 0 0 12px;">Proportion of variance in Y explained by the model. Range: 0 to 1. Higher = better fit.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">Adjusted R²</dt>
                                        <dd style="margin: 0 0 12px;">R² adjusted for the number of predictors. Penalizes adding useless variables. Use this when comparing models with different numbers of predictors.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">F-statistic</dt>
                                        <dd style="margin: 0 0 12px;">Tests whether the model as a whole is significant. Compares your model to a model with no predictors.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">p-value (Model)</dt>
                                        <dd style="margin: 0;">Probability of getting these results if no variables actually predict Y. &lt; 0.05 means the model is statistically significant.</dd>
                                    </dl>
                                </div>

                                <div>
                                    <h5 style="color: var(--text-primary); margin-bottom: 8px;">Coefficient Statistics</h5>
                                    <dl style="margin: 0; color: var(--text-secondary);">
                                        <dt style="font-weight: 600; color: var(--text-primary);">Coefficient (m or b)</dt>
                                        <dd style="margin: 0 0 12px;">The estimated effect of each variable on Y. For continuous X: change in Y for a 1-unit increase in X.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">Std Error</dt>
                                        <dd style="margin: 0 0 12px;">Precision of the coefficient estimate. Smaller = more precise.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">t-stat</dt>
                                        <dd style="margin: 0 0 12px;">Coefficient divided by its standard error. Larger absolute values indicate more significant predictors.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">p-value (Coefficient)</dt>
                                        <dd style="margin: 0 0 12px;">Tests if the coefficient is significantly different from zero. &lt; 0.05 means the variable contributes to predicting Y.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">95% CI</dt>
                                        <dd style="margin: 0;">95% Confidence Interval. We're 95% confident the true coefficient lies within this range.</dd>
                                    </dl>
                                </div>

                                <div>
                                    <h5 style="color: var(--text-primary); margin-bottom: 8px;">Residuals Diagnostics</h5>
                                    <dl style="margin: 0; color: var(--text-secondary);">
                                        <dt style="font-weight: 600; color: var(--text-primary);">Residual</dt>
                                        <dd style="margin: 0 0 12px;">Difference between actual and predicted values (Y - Ŷ). Should be randomly scattered around zero.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">Standardized Residual</dt>
                                        <dd style="margin: 0 0 12px;">Residual divided by its standard deviation. Values &gt; 2 or &lt; -2 may indicate outliers.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">MSE (Mean Squared Error)</dt>
                                        <dd style="margin: 0 0 12px;">Average squared difference between observed and predicted values. Lower = better predictions.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">Standard Error</dt>
                                        <dd style="margin: 0;">Standard deviation of the residuals. Typical prediction error in same units as Y.</dd>
                                    </dl>
                                </div>

                                <div>
                                    <h5 style="color: var(--text-primary); margin-bottom: 8px;">Significance Codes</h5>
                                    <dl style="margin: 0; color: var(--text-secondary);">
                                        <dt style="font-weight: 600; color: var(--text-primary);">*** p &lt; 0.001</dt>
                                        <dd style="margin: 0 0 8px;">Very strong evidence against null hypothesis</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">** p &lt; 0.01</dt>
                                        <dd style="margin: 0 0 8px;">Strong evidence against null hypothesis</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">* p &lt; 0.05</dt>
                                        <dd style="margin: 0 0 8px;">Moderate evidence against null hypothesis</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">(no stars)</dt>
                                        <dd style="margin: 0;">Not statistically significant at p &lt; 0.05 level</dd>
                                    </dl>
                                </div>

                                <div>
                                    <h5 style="color: var(--text-primary); margin-bottom: 8px;">Confidence Band vs Prediction Interval</h5>
                                    <dl style="margin: 0; color: var(--text-secondary);">
                                        <dt style="font-weight: 600; color: var(--text-primary);">Confidence Band (Mean Response)</dt>
                                        <dd style="margin: 0 0 12px;">The shaded region on the scatter plot shows where the <strong>mean</strong> of Y is likely to fall for a given X. Narrower band = more precise estimate of the regression line. Use this for estimating average values.</dd>

                                        <dt style="font-weight: 600; color: var(--text-primary);">Prediction Interval (Individual Values)</dt>
                                        <dd style="margin: 0;">Wider interval that accounts for both uncertainty in the regression line AND the natural variation of individual data points. Use this for predicting individual future observations. (Not shown on chart - would be ~2-3x wider)</dd>
                                    </dl>
                                </div>
                            </div>

                            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                                <h5 style="color: var(--text-primary); margin-bottom: 8px;">Assumptions of Linear Regression</h5>
                                <ul style="margin: 0; padding-left: 20px; color: var(--text-secondary);">
                                    <li><strong>Linearity:</strong> Relationship between X and Y is linear</li>
                                    <li><strong>Independence:</strong> Observations are independent of each other</li>
                                    <li><strong>Homoscedasticity:</strong> Residuals have constant variance at all levels of X</li>
                                    <li><strong>Normality:</strong> Residuals are approximately normally distributed</li>
                                    <li><strong>No multicollinearity:</strong> Predictors are not highly correlated with each other</li>
                                </ul>
                            </div>

                            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                                <h5 style="color: var(--text-primary); margin-bottom: 8px;">Multicollinearity & VIF Explained</h5>
                                <p style="margin: 0 0 8px 0; color: var(--text-secondary);">
                                    <strong>Multicollinearity</strong> occurs when predictor variables are highly correlated with each other. This can make it difficult to determine the individual effect of each predictor.
                                </p>
                                <p style="margin: 0 0 8px 0; color: var(--text-secondary);">
                                    <strong>VIF (Variance Inflation Factor)</strong> measures how much the variance of a coefficient is inflated due to multicollinearity:
                                </p>
                                <ul style="margin: 0; padding-left: 20px; color: var(--text-secondary);">
                                    <li><strong>VIF = 1:</strong> No correlation</li>
                                    <li><strong>1 &lt; VIF ≤ 5:</strong> Low multicollinearity (acceptable)</li>
                                    <li><strong>5 &lt; VIF ≤ 10:</strong> Moderate multicollinearity (review variables)</li>
                                    <li><strong>VIF &gt; 10:</strong> High multicollinearity (consider removing redundant variables)</li>
                                    <li><strong>VIF = ∞:</strong> Perfect multicollinearity (one variable is a linear combination of others)</li>
                                </ul>
                                <p style="margin: 8px 0 0 0; color: var(--text-secondary);">
                                    <strong>What to do:</strong> If VIF is high, consider removing one of the correlated variables or combining them into a single predictor.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="collapsible-header collapsed" id="licensesToggle" aria-expanded="false" role="button" tabindex="0">
                    <span class="title" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted);">
                        <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px; vertical-align: text-bottom;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <path d="M9 13v-1h6v1"/>
                            <path d="M11 17h2"/>
                        </svg>
                        Third-Party Licenses
                    </span>
                    <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </div>
                <div class="collapsible-content collapsed" id="licensesContent">
                    <div class="license-card" style="margin-top: 12px;">
                        <div class="license-content">
                            <ul>
                                <li>
                                    <a href="https://www.chartjs.org/" target="_blank" rel="noopener">Chart.js</a> — MIT License
                                    <span>© Chart.js Contributors</span>
                                </li>
                                <li>
                                    <a href="https://sheetjs.com/" target="_blank" rel="noopener">SheetJS (XLSX)</a> — Apache 2.0 License
                                    <span>© SheetJS LLC</span>
                                </li>
                                <li>
                                    <a href="https://github.com/jesse-anderson/linreg-core" target="_blank" rel="noopener">linreg-core</a> — MIT OR Apache-2.0 License
                                    <span>© Jesse Anderson</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

        <footer data-footer></footer>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Sheet Selector Modal -->
    <div class="modal-overlay" id="sheetModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Select Sheet</h3>
                <button class="modal-close" id="closeSheetModal">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="selector-group">
                    <label>Available Sheets</label>
                    <select id="sheetSelect"></select>
                </div>
                <div class="sheet-preview" id="sheetPreview">
                    Select a sheet to preview
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-btn" id="cancelSheetBtn">Cancel</button>
                <button class="tool-btn primary" id="confirmSheetBtn">Import Sheet</button>
            </div>
        </div>
    </div>

    <!-- Observation Detail Modal -->
    <div class="modal-overlay" id="obsDetailModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3>Observation Details</h3>
                <button class="modal-close" id="closeObsDetailBtn">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="obsDetailContent">
                <!-- Populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Model Comparison Modal -->
    <div class="modal-overlay" id="modelComparisonModal">
        <div class="modal modal-xlarge">
            <div class="modal-header">
                <h3>Model Comparison</h3>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button class="tool-btn" id="exportComparisonBtn" title="Export comparison as CSV" style="padding: 6px 12px; font-size: 0.75rem;">
                        <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export CSV
                    </button>
                    <button class="modal-close" id="closeModelComparisonBtn">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="modal-body" id="modelComparisonContent">
                <!-- Populated dynamically -->
            </div>
        </div>
    </div>

    <script type="module" src="js/logic.js"></script>
</body>
</html>